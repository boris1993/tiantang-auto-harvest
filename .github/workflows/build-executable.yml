name: Build and publish single executable

on: 
  push:
    branches: [ master, publish-single-executable ]
#    paths: ['.github/workflows/build-executable.yml', 'tiantang-auto-harvest/**']
  workflow_dispatch:
    
jobs: 
  build-latest-windows-executable:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.4.0
        
      - name: Setup .NET
        uses: actions/setup-dotnet@v2
        
      - name: Publish Windows x64
        run: dotnet build -c Release -p:DeployOnBuild=true -p:PublishProfile=win-x64

      - name: Publish Linux x64
        run: dotnet build -c Release -p:DeployOnBuild=true -p:PublishProfile=linux-x64
        
      - name: Publish Linux arm64
        run: dotnet build -c Release -p:DeployOnBuild=true -p:PublishProfile=linux-arm64
        
      - name: Publish Linux arm-v7
        run: dotnet build -c Release -p:DeployOnBuild=true -p:PublishProfile=linux-arm-v7
        
      - name: Archive files
        working-directory: tiantang-auto-harvest\bin\Release
        run: pwd && zip -r win-x64.zip win-x64
        
      - name: Show file content
        working-directory: tiantang-auto-harvest\bin\Release
        run: pwd && unzip -vl win-x64.zip